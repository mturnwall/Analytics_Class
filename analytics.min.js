/**
 *  A javascript class that makes it real easy to add custom google analytics tracking to any web site.
 *  The goal of this class is to reduce the amount of custom javascript that needs to be written for custom google analytic tracking.
 *
 *  @author Michael Turnwall
 *
 *	@class  GA
 *
 *  @license Copyright (c) 2013 Michael Turnwall
 *  Released under the GPL v3 License
 *  <p>This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.</p>
 *  <p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</p>
 *  <p>You should have received a copy of the GNU General Public License along with this program. If not, see <a href="http://www.gnu.org/licenses/gpl-3.0.html">&lt;http://www.gnu.org/licenses/gpl-3.0.html&gt;</a>.</p>
 */
var GA=function(){var defaults={domain:"",trackOutbound:!0,siteSearchSelector:"#searchForm",siteSearchInput:"q",timer:200},gaEvents={requestInfo:["_trackEvent","Request More Information","link"],siteSearch:["_trackEvent","Quick Search","main search"],printPage:["_trackEvent","Print","current page"],social:[["_trackSocial"],["_trackEvent","Social share"]]},availableProviders={Google:{defaults:{domain:"",debug:!1,enhancedLink:!1,trackingId:""},init:function(opts){var _gaq=window._gaq=window._gaq||[];if(options="string"!=typeof opts?GA.extend({},this.defaults,opts):GA.extend({},this.defaults,{trackingId:opts}),scriptName=options.debug?"u/ga_debug.js":"ga.js",options.enhancedLink&&_gaq.push(["_require","inpage_linkid","//www.google-analytics.com/plugins/ga/inpage_linkid.js"]),!options.trackingId)throw Error("You need to provide a tracking ID for Google Analytics");_gaq.push(["_setAccount",options.trackingId]),options.domain&&_gaq.push(["_setDomainName",options.domain]),_gaq.push(["_trackPageview"]),function(){var ga,s;ga=document.createElement("script"),ga.type="text/javascript",ga.async=!0,ga.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/"+scriptName,s=document.getElementsByTagName("script")[0],s.parentNode.insertBefore(ga,s)}()}}};return{version:"0.4.1",ready:!1,cleanValue:function(value){return value=value.replace(/^(\s)*/,""),value=value.replace(/(\s)*$/,"")},loadProviders:function(providers){var key,provider;for(key in providers)try{provider=availableProviders[key],provider.init(providers[key])}catch(e){throw Error('Sorry, no provider with the name of "'+key+'" is available')}this.ready=!0},extend:function(){var property,source,target=arguments[0]||{},i=1,length=arguments.length;for(length===i&&(target=this,i=0);length>i;i++)if(source=arguments[i],null!==source)for(property in source)target[property]=source[property];return target},processFactoryOptions:function(gaOptions,parameters){var i,z,params=parameters;if(gaOptions)if("string"!=typeof gaOptions)for(i=0,z=gaOptions.length;z>i;i++)params.push(this.cleanValue(gaOptions[i])||"");else params.push(gaOptions);return params},factory:function(gaType,gaOptions){var key,gaEvent,parameters=!1;if(this.gaEvents[gaType]){parameters=[];for(key in this.gaEvents[gaType]){if(gaEvent=JSON.parse(JSON.stringify(this.gaEvents[gaType])),"string"==typeof this.gaEvents[gaType][key]){parameters.push(this.processFactoryOptions(gaOptions,gaEvent));break}parameters.push(this.processFactoryOptions(gaOptions,gaEvent[key]))}}return parameters},pushTrackEvent:function(parameters){var key;for(key in parameters)_gaq.push(parameters[key])},outboundLinks:function(el){var link=el.href,exitType=link.match(/maps.google.com/gi)?"Google Maps Driving Directions":"exit";GA.pushTrackEvent([["_trackEvent","Outbound Links",exitType,link]]),setTimeout(function(){location.href=link},this.opts.timer)},trackSiteSearch:function(form){return this.pushTrackEvent(this.factory("siteSearch",form[this.opts.siteSearchInput].value)),!0},trackForms:function(form){var controlType,analyticsType=form.getAttribute("data-analytics-type")||!1,analyticsInfo="";return analyticsType&&($("input, select",form).each(function(){controlType=this.getAttribute("type"),this.getAttribute("data-analytics-track-value")&&("text"===controlType||"hidden"===controlType?analyticsInfo+=":"+this.value:"radio"!==controlType&&"checkbox"!==controlType||!this.checked||(analyticsInfo+=":"+this.value))}),this.pushTrackEvent(this.factory(analyticsType,analyticsInfo.substr(1)))),!0},trackLinks:function(el){var regexp=RegExp("^http(s)?://([a-z]+\\.)?("+this.opts.domain+")","ig"),parameters=!1;if(this.analyticsType=el.getAttribute("data-analytics-type")||!1,this.analyticsType)parameters=[],this.analyticsInfo=el.getAttribute("data-analytics-info")?el.getAttribute("data-analytics-info").split(","):"",parameters=this.factory(this.analyticsType,this.analyticsInfo);else if(!el.href.match(regexp))return this.outboundLinks(el),!1;return parameters?(this.pushTrackEvent(parameters),!0):void 0},init:function(userEvents,options){var that=this;this.gaEvents=this.extend(gaEvents,userEvents),this.opts=this.extend(defaults,options),$("body").on("click","a",function(){return that.trackLinks(this)}),$("form").on("submit",function(){return that.trackForms(this),!1}),$(this.opts.siteSearchSelector).submit(function(){return that.trackSiteSearch(this)})}}}();